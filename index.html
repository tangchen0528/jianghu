<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>情義江湖点歌系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            width: 100vw;
            height: 100vh;
            overflow-x: hidden;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            color: #fff;
            min-height: 100vh;
            background-color: #8B0000;
            background-image: none;
            overflow-x: hidden;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }
        .bg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background-size: cover; background-position: center; opacity: 1;
            transition: opacity 0.8s ease-in-out, background-image 0.8s ease-in-out;
        }
        .container {
            background-color: transparent;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            position: relative;
            z-index: 10;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.2); color: #FFD700; padding: 15px; text-align: center;
            border-bottom: 2px solid #FF6B6B;
            z-index: 100;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header h1 {
            font-size: 28px; font-weight: 800; letter-spacing: 2px; font-family: 'Arial Black', sans-serif;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8); margin: 0;
        }
        .fixed-header {
            position: fixed;
            top: 80px;
            left: 0;
            width: 100%;
            background-color: rgba(0,0,0,0.2);
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 90;
            height: 140px;
            box-sizing: border-box;
        }
        .artist-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 12px;
            height: 80px;
        }
        .tag-btn {
            height: 40px; background-color: rgba(255,255,255,0.1); color: #fff; border-radius: 8px;
            font-weight: 700; cursor: pointer; transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.2);
            text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center;
            justify-content: center; font-size: 11px; white-space: nowrap; overflow: hidden;
            text-overflow: ellipsis; padding: 0 8px;
        }
        .tag-btn:active { transform: scale(0.95); background-color: rgba(255,215,0,0.3); }
        .tag-btn.active {
            background: linear-gradient(45deg, #FFD700, #FFA500); color: #8B0000;
            box-shadow: 0 4px 8px rgba(255,215,0,0.4);
        }
        .search-box {
            background-color: transparent;
            padding: 0;
            margin-top: 10px;
            height: 36px;
        }
        #searchInput {
            width: 100%;
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 14px;
            color: #fff;
            background-color: rgba(0,0,0,0.2);
            outline: none;
            height: 100%;
        }
        #searchInput::placeholder { color: #ccc; }
        .list-title {
            position: fixed;
            top: 220px;
            left: 0;
            width: 100%;
            padding: 10px 15px;
            background-color: rgba(0,0,0,0.3);
            border-top: 1px solid rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            z-index: 80;
            height: 50px;
        }
        .list-title h2 {
            font-size: 14px;
            color: #FFD700; font-weight: 700; border-left: 3px solid #FFD700;
            padding-left: 8px; margin: 0; display: flex; align-items: center; flex: 1;
            line-height: 1;
        }
        .song-count {
            margin-left: 8px;
            font-size: 12px;
            color: #fff !important;
        }
        .list-control-btn {
            background: none; border: none; padding: 6px 10px;
            border-radius: 0; cursor: pointer;
            display: flex; align-items: center; gap: 4px;
            font-size: 12px;
            color: #FFD700;
            font-weight: bold; transition: background-color 0.2s;
            height: 35px;
        }
        .list-control-btn:hover { background-color: rgba(255,255,255,0.2); }
        .arrow-icon {
            width: 12px;
            height: 12px;
            fill: #FFD700;
        }
        .modal {
            display: none;
            position: absolute;
            top: 10px;
            right: 12px;
            width: 160px;
            height: auto;
            background-color: transparent;
            z-index: 1001;
            padding: 0;
            margin-top: 10px;
        }
        .modal-content {
            background-color: rgba(34,34,34,0.8);
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            box-shadow: 0 4px 20px rgba(255,215,0,0.4);
            border: 1px solid #FFD700;
            margin-top: 0;
        }
        .modal-title {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 14px;
            text-align: center;
            border-bottom: 1px solid #FFD700;
            padding-bottom: 8px;
        }
        .modal-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #333;
            color: #fff;
            font-size: 12px;
        }
        .modal-option label { flex: 1; }
        .modal-option input { transform: scale(1); margin-right: 5px; }
        .modal-footer { display: flex; justify-content: space-around; margin-top: 10px; }
        .modal-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
        }
        .btn-confirm { background-color: #FFD700; color: #8B0000; }
        .btn-cancel { background-color: #555; color: #fff; }

        .song-list-wrapper {
            position: fixed;
            top: 270px;
            left: 0;
            bottom: 65px;
            width: 100%;
            padding: 10px 8px 15px 8px;
            overflow-y: auto !important;
            overflow-x: hidden;
            background-color: rgba(0,0,0,0.1);
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            z-index: 70;
        }

        .song-list-wrapper::-webkit-scrollbar { width: 6px; }
        .song-list-wrapper::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 3px; }
        .song-list-wrapper::-webkit-scrollbar-thumb { background: #FF6B6B; border-radius: 3px; }

        .song-list-content {
            display: grid;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
            padding-bottom: 15px;
        }
        .song-list-content.single-col {
            grid-template-columns: 1fr;
        }
        .song-list-content.two-col {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        .song-list-content.three-col {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }

        .song-item {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 8px 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            transition: background-color 0.3s ease;
            min-height: 55px;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        .song-item.collect-active {
            background-color: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.1);
        }
        .thumbnail {
            width: clamp(30px, 8vw, 40px);
            height: clamp(30px, 8vw, 40px);
            border-radius: 6px;
            overflow: hidden;
            flex-shrink: 0;
            background: #fff;
            margin-right: 5px;
        }
        .placeholder-img {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            font-size: clamp(10px, 2vw, 12px);
            background: linear-gradient(45deg, #fff, #f0f0f0);
        }
        .song-details {
            flex: 1;
            margin-left: 5px;
            overflow: hidden;
            padding-right: 20px;
        }
        .song-title {
            font-size: clamp(12px, 3vw, 14px);
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .song-artist {
            font-size: clamp(10px, 2vw, 11px);
            color: #ccc;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .collect-star {
            position: absolute;
            right: clamp(10px, 3%, 15px);
            bottom: clamp(10px, 3%, 15px);
            font-size: clamp(12px, 2vw, 15px);
            color: #fff;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
            flex-shrink: 0;
            z-index: 10;
        }
        .collect-star.active { color: #FFD700; transform: scale(1.1); }
        .collect-star:active { transform: scale(0.9); }
        .no-song-tip {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #ccc;
            font-size: 16px;
            padding: 20px 0;
        }
        .collect-tip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px 20px;
            background-color: rgba(0,0,0,0.8);
            color: #FFD700;
            border-radius: 6px;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .collect-tip.show { opacity: 1; }

        .collect-page {
            display: none;
            position: fixed;
            top: 270px;
            left: 0;
            bottom: 65px;
            width: 100%;
            padding: 15px 8px;
            text-align: center;
            align-items: flex-start;
            justify-content: flex-start;
            flex-direction: column;
            color: #ccc;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            z-index: 70;
            background-color: rgba(0,0,0,0.1);
        }
        .collect-page h3 { color: #FFD700; margin-bottom: 15px; width: 100%; text-align: center; }
        .collect-page .song-list-content {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        .collect-page .song-item {
            min-height: 55px;
            width: 100%;
        }
        .collect-page .song-details { padding-right: 20px; }

        .setting-page {
            display: none;
            position: fixed;
            top: 80px;
            left: 0;
            bottom: 65px;
            width: 100%;
            background-color: rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            flex-direction: row;
            overflow-y: hidden;
            z-index: 85;
        }
        .setting-sidebar {
            width: 120px;
            background-color: rgba(0,0,0,0.3);
            padding: 15px 0;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: 100%;
        }
        .setting-sidebar-btn {
            height: 40px;
            line-height: 40px;
            text-align: center;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .setting-sidebar-btn.active {
            background-color: rgba(255,215,0,0.2);
            color: #FFD700;
            border-left-color: #FFD700;
        }
        .setting-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto !important;
            display: none;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            height: 100%;
        }
        .setting-content.active { display: block; }
        .setting-group {
            background-color: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .setting-group h3 { color: #FFD700; margin-bottom: 10px; font-size: 16px; }
        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
            width: 100%;
        }
        .setting-item label { font-size: 14px; color: #fff; }
        .setting-item input, .setting-item select {
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.2);
            background-color: rgba(0,0,0,0.3);
            color: #fff;
            outline: none;
            width: 100%;
        }
        .setting-item input[type="range"] { padding: 0; }
        .color-selector { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .color-block {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s ease;
        }
        .color-block:hover { transform: scale(1.1); }
        .color-block.active { border-color: #FFD700; }
        .software-info { font-size: 16px; line-height: 2; color: #eee; padding: 20px; }

        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 65px;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            border-top: 2px solid #FFD700;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 12px;
            gap: 4px;
            padding: 5px 0;
        }
        .tab-item.active { color: #FFD700; }
        .tab-icon { font-size: 20px; }
        .home-page {
            display: block;
            height: 100%;
            width: 100%;
        }
        @media (max-width: 360px) {
            .song-list-content.three-col {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            }
            .song-item {
                padding: 6px 6px;
                min-height: 50px;
            }
        }
        @media (min-width: 400px) {
            .song-list-content.two-col {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <base target="_blank">
</head>
<body>
    <div class="bg-container" id="bgContainer"></div>
    <div class="collect-tip" id="collectTip"></div>
    <div class="container">
        <div class="header">
            <h1 id="title">情義江湖点歌系统</h1>
        </div>
        <div class="home-page" id="homePage">
            <div class="fixed-header">
                <div class="artist-section" id="tagContainer">
                    <button class="tag-btn active" data-artist="all">歌单大全</button>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索歌曲">
                </div>
            </div>
            <div class="list-title">
                <h2 id="listTitle">歌曲列表 <span id="countText" class="song-count">(0首)</span></h2>
                <button id="layoutTrigger" class="list-control-btn">
                    <span id="layoutText">布局</span>
                    <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="sortTrigger" class="list-control-btn">
                    <span id="sortText">排序</span>
                    <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" fill="currentColor"/>
                    </svg>
                </button>
                <div id="layoutModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-title" id="layoutModalTitle">布局设置</div>
                        <div class="modal-option">
                            <label for="layoutSingle">单排显示</label>
                            <input type="radio" id="layoutSingle" name="layoutType" value="single" checked>
                        </div>
                        <div class="modal-option">
                            <label for="layoutDouble">双排显示</label>
                            <input type="radio" id="layoutDouble" name="layoutType" value="double">
                        </div>
                        <div class="modal-option">
                            <label for="layoutTriple">三排显示</label>
                            <input type="radio" id="layoutTriple" name="layoutType" value="triple">
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn btn-cancel" id="layoutCancelBtn">取消</button>
                            <button class="modal-btn btn-confirm" id="layoutConfirmBtn">确定</button>
                        </div>
                    </div>
                </div>
                <div id="sortModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-title" id="sortModalTitle">排序设置</div>
                        <div class="modal-option">
                            <label for="orderAsc">正序 (A-Z)</label>
                            <input type="radio" id="orderAsc" name="sortOrder" value="asc">
                        </div>
                        <div class="modal-option">
                            <label for="orderDesc">倒序 (Z-A)</label>
                            <input type="radio" id="orderDesc" name="sortOrder" value="desc">
                        </div>
                        <div class="modal-option">
                            <label for="orderRandom">随机排序</label>
                            <input type="radio" id="orderRandom" name="sortOrder" value="random" checked>
                        </div>
                        <hr style="border: 1px solid #333; margin: 15px 0;">
                        <div class="modal-option">
                            <label for="sortByTitle">按名称排序</label>
                            <input type="radio" id="sortByTitle" name="sortType" value="title" checked>
                        </div>
                        <div class="modal-option">
                            <label for="sortByArtist">按歌手排序</label>
                            <input type="radio" id="sortByArtist" name="sortType" value="artist">
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn btn-cancel" id="cancelBtn">取消</button>
                            <button class="modal-btn btn-confirm" id="confirmBtn">确定</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="song-list-wrapper">
                <div class="song-list-content" id="songListContainer"></div>
            </div>
        </div>
        <div class="collect-page" id="collectPage">
            <h3 id="collectTitle">我的收藏</h3>
            <p id="collectEmpty">暂无收藏歌曲</p>
        </div>
        <div class="setting-page" id="settingPage">
            <div class="setting-sidebar">
                <div class="setting-sidebar-btn active" data-target="lang-content">语言</div>
                <div class="setting-sidebar-btn" data-target="bg-content">背景</div>
                <div class="setting-sidebar-btn" data-target="software-content">软件</div>
            </div>
            <div class="setting-content active" id="lang-content">
                <div class="setting-group">
                    <h3 id="langTitle">语言设置</h3>
                    <div class="setting-item">
                        <label for="languageSelect">选择语言</label>
                        <select id="languageSelect">
                            <option value="zh">中文</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="setting-content" id="bg-content">
                <div class="setting-group">
                    <h3 id="bgTitle">背景设置</h3>
                    <div class="setting-item">
                        <label for="bgFileInput">本地背景</label>
                        <input type="file" id="bgFileInput" accept="images/JH01.jpg*">
                    </div>
                    <div class="setting-item">
                        <label for="bgUrlInput" id="bgUrlLabel">网络背景</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="bgUrlInput" placeholder="输入URL" style="flex: 1;">
                            <button id="bgUrlConfirmBtn" style="padding: 8px 15px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background-color: rgba(0,0,0,0.3); color: #FFD700; cursor: pointer; font-weight: bold;">确定</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="bgOpacity">背景透明度</label>
                        <input type="range" id="bgOpacity" min="0.1" max="1" step="0.1" value="1">
                        <span id="opacityValue">100%</span>
                    </div>
                    <div class="setting-item">
                        <label id="bgColorLabel">纯色背景</label>
                        <div class="color-selector">
                            <div class="color-block" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-block" style="background-color: #FFFFFF;" data-color="#FFFFFF"></div>
                            <div class="color-block" style="background-color: #8B0000;" data-color="#8B0000"></div>
                            <div class="color-block" style="background-color: #008000;" data-color="#008000"></div>
                            <div class="color-block" style="background-color: #FFA500;" data-color="#FFA500"></div>
                            <div class="color-block" style="background-color: #FFFF00;" data-color="#FFFF00"></div>
                            <div class="color-block" style="background-color: #800080;" data-color="#800080"></div>
                            <div class="color-block" style="background-color: #0000FF;" data-color="#0000FF"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="setting-content" id="software-content">
                <div class="software-info">
                    <p>版本：V1.0</p>
                    <p>作者：汤晨</p>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-bar">
        <div class="tab-item active" id="homeTab">
            <i class="fas fa-home tab-icon"></i>
            <span id="homeText">首页</span>
        </div>
        <div class="tab-item" id="collectTab">
            <i class="fas fa-star tab-icon"></i>
            <span id="collectText">收藏</span>
        </div>
        <div class="tab-item" id="settingTab">
            <i class="fas fa-cog tab-icon"></i>
            <span id="settingText">设置</span>
        </div>
    </div>
    <script>
    // ====================== 默认背景图片配置 ======================
    const DEFAULT_BG_URL = 'https://jianghu-0gpk3pxh37b5503e-1392378192.tcloudbaseapp.com/images/JH01.jpg';

        // ====================== 歌手&歌曲集中配置区（核心维护区） ======================
        const artistConfig = {
            judy: { name: "女歌 Judy", songs: `阿刁\n爱\n爱上一个不回家的人\n爱不爱我\n爱之初体验` },
            ting: { name: "女歌 小婷", songs: `乌兰巴巴托的夜\n旅行\n阳光彩虹小白马\n把悲伤留给自己\n生而为人` },
            zhiyu: { name: "男歌 致宇", songs: `像梦一样自由    汪峰\n夕阳醉了\t\t张学友\n童话\t\t       光良\n不再犹豫\t\tBeyond \n护花使者\t\t李克勤` },
            echo: { name: "男歌 Echo", songs: `梦醒时分C\n隆里电丝 (Live)E\n如果这都不算爱D\n花海F\n爱的飞行日记E` },
            hainan: { name: "女歌 海南", songs: `梦醒\n隆里\n如果\n花海\n爱的` },
            xiaolajiao: { name: "女歌 小辣椒", songs: `1\n2\n3\n4\n5\n6\n7` },
        }

        // ====================== GitHub背景图片自动播放配置（新增核心代码） ======================
        const GITHUB_CONFIG = {
            // ⚠️⚠️⚠️ 必须修改以下三个参数 ⚠️⚠️⚠️
            username: 'tangchen0528',  // 你的GitHub用户名
            repo: 'jianghu',            // 仓库名称
            path: 'images',         // 图片文件夹（如：assets 或 images）
            
            // 以下参数可按需调整
            branch: 'main',          // 分支名
            autoRotate: true,        // 是否自动轮换
            interval: 5000,          // 切换间隔（毫秒）
            randomOrder: true        // 是否随机顺序
        };

        // 获取GitHub文件夹中的图片列表
        async function fetchGitHubImages() {
            const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;
            
            try {
                const response = await fetch(apiUrl, {
                    headers: { 'Accept': 'application/vnd.github.v3+json' }
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const files = await response.json();
                return files
                    .filter(file => /.(jpg|jpeg|png|gif|webp)$/i.test(file.name))
                    .map(file => ({
                        name: file.name,
                        url: `https://raw.githubusercontent.com/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.path}/${encodeURIComponent(file.name)}`
                    }));
            } catch (error) {
                console.warn('GitHub图片加载失败:', error);
                return [];
            }
        }

        // 背景轮换器
        class BackgroundRotator {
            constructor() {
                this.images = [];
                this.currentIndex = 0;
                this.intervalId = null;
            }
            
            async init() {
                this.images = await fetchGitHubImages();
                if (this.images.length === 0) return;
                
                if (GITHUB_CONFIG.randomOrder) {
                    this.images = this.images.sort(() => Math.random() - 0.5);
                }
                
                this.nextImage();
                if (GITHUB_CONFIG.autoRotate) this.start();
            }
            
            start() {
                this.stop();
                this.intervalId = setInterval(() => this.nextImage(), GITHUB_CONFIG.interval);
            }
            
            stop() {
                if (this.intervalId) clearInterval(this.intervalId);
            }
            
            nextImage() {
                if (this.images.length === 0) return;
                const image = this.images[this.currentIndex];
                bgContainer.style.backgroundImage = `url(${image.url})`;
                currentBgType = 'image';
                this.currentIndex = (this.currentIndex + 1) % this.images.length;
            }
        }

        const bgRotator = new BackgroundRotator();

        // ====================== 自动构建数据（无需修改） ======================
        function convertSongList(songText, artistKey, artistName) {
            return songText.split('\n').filter(title => title.trim()).map((title, index) => ({
                id: `${artistKey}_${index + 1}`,
                title: title.trim().replace(/^\d+[\.\s]+/, ''),
                artist: artistName,
                cover: title.trim().replace(/^\d+[\.\s]+/, '').charAt(0) || '♪'
            }));
        }

        const musicData = { all: [] };
        Object.keys(artistConfig).forEach(artistKey => {
            const config = artistConfig[artistKey];
            musicData[artistKey] = convertSongList(config.songs, artistKey, config.name);
            musicData.all = musicData.all.concat(musicData[artistKey]);
        });

        // ====================== 页面元素 ======================
        const bgContainer = document.getElementById('bgContainer');
        const homePage = document.getElementById('homePage');
        const collectPage = document.getElementById('collectPage');
        const settingPage = document.getElementById('settingPage');
        const homeTab = document.getElementById('homeTab');
        const collectTab = document.getElementById('collectTab');
        const settingTab = document.getElementById('settingTab');
        const tagContainer = document.getElementById('tagContainer');
        const searchInput = document.getElementById('searchInput');
        const songListContainer = document.getElementById('songListContainer');
        const countText = document.getElementById('countText');
        const layoutTrigger = document.getElementById('layoutTrigger');
        const layoutModal = document.getElementById('layoutModal');
        const layoutSingle = document.getElementById('layoutSingle');
        const layoutDouble = document.getElementById('layoutDouble');
        const layoutTriple = document.getElementById('layoutTriple');
        const layoutCancelBtn = document.getElementById('layoutCancelBtn');
        const layoutConfirmBtn = document.getElementById('layoutConfirmBtn');
        const sortTrigger = document.getElementById('sortTrigger');
        const sortModal = document.getElementById('sortModal');
        const orderAsc = document.getElementById('orderAsc');
        const orderDesc = document.getElementById('orderDesc');
        const orderRandom = document.getElementById('orderRandom');
        const sortByTitle = document.getElementById('sortByTitle');
        const sortByArtist = document.getElementById('sortByArtist');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const languageSelect = document.getElementById('languageSelect');
        const bgFileInput = document.getElementById('bgFileInput');
        const bgOpacity = document.getElementById('bgOpacity');
        const opacityValue = document.getElementById('opacityValue');
        const bgUrlInput = document.getElementById('bgUrlInput');
        const bgUrlConfirmBtn = document.getElementById('bgUrlConfirmBtn');
        const collectEmpty = document.getElementById('collectEmpty');
        const collectTip = document.getElementById('collectTip');

        // ====================== 状态管理 ======================
        let currentSongs = musicData.all;
        let originalSongs = [...currentSongs];
        let previousState = { order: 'random', type: 'title' };
        let previousLayout = 'single';
        let collectSongs = [];
        let currentBgType = 'color';
        let currentColor = '#8B0000';
        let tempLayout = previousLayout;
        let tempSortState = { ...previousState };

        // ====================== 语言包 ======================
        const langPkg = {
            zh: {
                title: "情義江湖点歌系统", homeText: "首页", collectText: "收藏", settingText: "设置",
                allTag: "歌单大全", searchPlaceholder: "搜索歌曲", listTitle: "歌曲列表",
                layoutText: "布局", sortText: "排序", layoutModalTitle: "布局设置",
                singleLabel: "单排显示", doubleLabel: "双排显示", tripleLabel: "三排显示",
                sortModalTitle: "排序设置", ascLabel: "正序 (A-Z)", descLabel: "倒序 (Z-A)",
                randomLabel: "随机排序", sortTitleLabel: "按名称排序", sortArtistLabel: "按歌手排序",
                cancelBtn: "取消", confirmBtn: "确定", collectTitle: "我的收藏", collectEmpty: "暂无收藏歌曲",
                noSongTip: "无匹配歌曲", langTitle: "语言设置", langLabel: "选择语言",
                bgTitle: "背景设置", bgImgLabel: "选择本地背景图片", bgUrlLabel: "或输入网络图片URL",
                opacityLabel: "背景透明度", bgColorLabel: "选择纯色背景"
            },
            en: {
                title: "Qingyi Jianghu Song System", homeText: "Home", collectText: "Collect", settingText: "Settings",
                allTag: "All Songs", searchPlaceholder: "Search Songs", listTitle: "Song List",
                layoutText: "Layout", sortText: "Sort", layoutModalTitle: "Layout Settings",
                singleLabel: "Single Column", doubleLabel: "Double Columns", tripleLabel: "Triple Columns",
                sortModalTitle: "Sort Settings", ascLabel: "Ascending (A-Z)", descLabel: "Descending (Z-A)",
                randomLabel: "Random Sort", sortTitleLabel: "Sort by Name", sortArtistLabel: "Sort by Artist",
                cancelBtn: "Cancel", confirmBtn: "Confirm", collectTitle: "My Collection", collectEmpty: "No collected songs",
                noSongTip: "No matching songs", langTitle: "Language Settings", langLabel: "Select Language",
                bgTitle: "Background Settings", bgImgLabel: "Select Local Background Image", bgUrlLabel: "Or enter image URL",
                opacityLabel: "Background Opacity", bgColorLabel: "Select Solid Background Color"
            }
        };

        // ====================== 初始化页面 ======================
        function initPage() {
            // 强制设置背景容器样式
            bgContainer.style.opacity = '1';
            bgContainer.style.zIndex = '0';
            bgContainer.style.backgroundColor = 'transparent';
            
            // 启动GitHub背景轮换
            bgRotator.init().catch(err => {
                console.warn('自动背景加载失败:', err);
            });
            
            generateArtistTags();
            renderSongs([...currentSongs].sort(() => Math.random() - 0.5));
            initTabSwitch();
            initLayoutSwitch();
            initSortSwitch();
            initSetting();
            initTagClick();
            initSearch();
            applyLayout('single');
            window.addEventListener('resize', () => applyLayout(previousLayout));
        }

        // 自动生成歌手标签按钮
        function generateArtistTags() {
            let tagsHtml = '<button class="tag-btn active" data-artist="all">歌单大全</button>';
            Object.keys(artistConfig).forEach(artistKey => {
                tagsHtml += `<button class="tag-btn" data-artist="${artistKey}">${artistConfig[artistKey].name}</button>`;
            });
            tagContainer.innerHTML = tagsHtml;
        }

        // ====================== 核心功能函数 ======================
        function renderSongs(songs) {
            if (songs.length === 0) {
                songListContainer.innerHTML = `<div class="no-song-tip">${langPkg[languageSelect.value].noSongTip}</div>`;
                countText.textContent = `(0首)`;
                return;
            }

            songListContainer.innerHTML = songs.map(song => {
                const isCollected = collectSongs.some(s => s.id === song.id);
                return `
                    <div class="song-item ${isCollected ? 'collect-active' : ''}" data-id="${song.id}">
                        <div class="thumbnail"><div class="placeholder-img">${song.cover}</div></div>
                        <div class="song-details">
                            <div class="song-title">${song.title}</div>
                            <div class="song-artist">${song.artist}</div>
                        </div>
                        <i class="fas fa-star collect-star ${isCollected ? 'active' : ''}" data-id="${song.id}"></i>
                    </div>
                `;
            }).join('');

            // 绑定收藏事件
            document.querySelectorAll('.collect-star').forEach(star => {
                star.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const songId = this.dataset.id;
                    const songItem = document.querySelector(`.song-item[data-id="${songId}"]`);
                    const isCollected = this.classList.contains('active');

                    if (isCollected) {
                        removeCollect(songId);
                        this.classList.remove('active');
                        songItem.classList.remove('collect-active');
                        showTip('取消收藏成功');
                    } else {
                        addCollect(songId);
                        this.classList.add('active');
                        songItem.classList.add('collect-active');
                        showTip('收藏歌曲成功');
                    }
                    updateCollectPage();
                });
            });

            countText.textContent = `(${songs.length}首)`;
        }

        function showTip(text) {
            collectTip.textContent = text;
            collectTip.classList.add('show');
            setTimeout(() => collectTip.classList.remove('show'), 1500);
        }

        function addCollect(songId) {
            if (!collectSongs.some(s => s.id === songId)) {
                const song = currentSongs.find(s => s.id === songId);
                collectSongs.push(song);
                updateCollectPage();
            }
        }

        function removeCollect(songId) {
            collectSongs = collectSongs.filter(s => s.id !== songId);
            updateCollectPage();
        }

        function updateCollectPage() {
            if (collectSongs.length === 0) {
                collectPage.innerHTML = `<h3 id="collectTitle">${langPkg[languageSelect.value].collectTitle}</h3><p id="collectEmpty">${langPkg[languageSelect.value].collectEmpty}</p>`;
            } else {
                const html = collectSongs.map(song => {
                    const isCollected = collectSongs.some(s => s.id === song.id);
                    return `
                        <div class="song-item ${isCollected ? 'collect-active' : ''}" data-id="${song.id}">
                            <div class="thumbnail"><div class="placeholder-img">${song.cover}</div></div>
                            <div class="song-details">
                                <div class="song-title">${song.title}</div>
                                <div class="song-artist">${song.artist}</div>
                            </div>
                            <i class="fas fa-star collect-star ${isCollected ? 'active' : ''}" data-id="${song.id}"></i>
                        </div>
                    `;
                }).join('');
                collectPage.innerHTML = `<h3 id="collectTitle">${langPkg[languageSelect.value].collectTitle}</h3><div class="song-list-content">${html}</div>`;
            }
        }

        function initTagClick() {
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const artist = this.dataset.artist;
                    currentSongs = artist === 'all' ? musicData.all : musicData[artist];
                    originalSongs = [...currentSongs];

                    sortSongs(previousState.type, previousState.order);
                });
            });
        }

        function initSearch() {
            searchInput.addEventListener('input', function() {
                const keyword = this.value.trim().toLowerCase();
                if (keyword === '') {
                    currentSongs = [...originalSongs];
                } else {
                    currentSongs = originalSongs.filter(song =>
                        song.title.toLowerCase().includes(keyword)
                    );
                }
                sortSongs(previousState.type, previousState.order);
            });
        }

        function initTabSwitch() {
            homeTab.addEventListener('click', function() {
                setActiveTab(this);
                homePage.style.display = 'block';
                collectPage.style.display = 'none';
                settingPage.style.display = 'none';
            });

            collectTab.addEventListener('click', function() {
                setActiveTab(this);
                homePage.style.display = 'none';
                collectPage.style.display = 'flex';
                settingPage.style.display = 'none';
                updateCollectPage();
            });

            settingTab.addEventListener('click', function() {
                setActiveTab(this);
                homePage.style.display = 'none';
                collectPage.style.display = 'none';
                settingPage.style.display = 'flex';
            });
        }

        function setActiveTab(tab) {
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            tab.classList.add('active');
        }

        function initLayoutSwitch() {
            let isLayoutModalOpen = false;

            layoutTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                isLayoutModalOpen = !isLayoutModalOpen;
                layoutModal.style.display = isLayoutModalOpen ? 'block' : 'none';
                sortModal.style.display = 'none';

                tempLayout = previousLayout;
                if (tempLayout === 'single') layoutSingle.checked = true;
                else if (tempLayout === 'double') layoutDouble.checked = true;
                else if (tempLayout === 'triple') layoutTriple.checked = true;
            });

            layoutSingle.addEventListener('change', function() {
                if (isLayoutModalOpen) {
                    tempLayout = 'single';
                    applyLayout(tempLayout);
                    songListContainer.style.display = 'none';
                    setTimeout(() => songListContainer.style.display = 'grid', 0);
                }
            });

            layoutDouble.addEventListener('change', function() {
                if (isLayoutModalOpen) {
                    tempLayout = 'double';
                    applyLayout(tempLayout);
                    songListContainer.style.display = 'none';
                    setTimeout(() => songListContainer.style.display = 'grid', 0);
                }
            });

            layoutTriple.addEventListener('change', function() {
                if (isLayoutModalOpen) {
                    tempLayout = 'triple';
                    applyLayout(tempLayout);
                    songListContainer.style.display = 'none';
                    setTimeout(() => songListContainer.style.display = 'grid', 0);
                }
            });

            layoutCancelBtn.addEventListener('click', function() {
                isLayoutModalOpen = false;
                layoutModal.style.display = 'none';
                applyLayout(previousLayout);
                songListContainer.style.display = 'none';
                setTimeout(() => songListContainer.style.display = 'grid', 0);
            });

            layoutConfirmBtn.addEventListener('click', function() {
                isLayoutModalOpen = false;
                layoutModal.style.display = 'none';
                previousLayout = tempLayout;
                applyLayout(previousLayout);
                songListContainer.style.display = 'none';
                setTimeout(() => songListContainer.style.display = 'grid', 0);
            });

            document.addEventListener('click', function() {
                if (isLayoutModalOpen) {
                    isLayoutModalOpen = false;
                    layoutModal.style.display = 'none';
                    applyLayout(previousLayout);
                    songListContainer.style.display = 'none';
                    setTimeout(() => songListContainer.style.display = 'grid', 0);
                }
            });

            layoutModal.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        function applyLayout(type) {
            songListContainer.classList.remove('single-col', 'two-col', 'three-col');
            if (type === 'single') {
                songListContainer.classList.add('single-col');
            } else if (type === 'double') {
                songListContainer.classList.add('two-col');
            } else if (type === 'triple') {
                songListContainer.classList.add('three-col');
            }
        }

        function initSortSwitch() {
            let isSortModalOpen = false;

            sortTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                isSortModalOpen = !isSortModalOpen;
                sortModal.style.display = isSortModalOpen ? 'block' : 'none';
                layoutModal.style.display = 'none';

                tempSortState = { ...previousState };
                tempSortedSongs = [...currentSongs];

                if (tempSortState.order === 'asc') orderAsc.checked = true;
                else if (tempSortState.order === 'desc') orderDesc.checked = true;
                else orderRandom.checked = true;

                if (tempSortState.type === 'title') sortByTitle.checked = true;
                else sortByArtist.checked = true;
            });

            orderAsc.addEventListener('change', function() {
                if (isSortModalOpen) {
                    tempSortState.order = 'asc';
                    tempSortedSongs = sortSongsPreview(tempSortState.type, tempSortState.order);
                    renderSongs(tempSortedSongs);
                }
            });

            orderDesc.addEventListener('change', function() {
                if (isSortModalOpen) {
                    tempSortState.order = 'desc';
                    tempSortedSongs = sortSongsPreview(tempSortState.type, tempSortState.order);
                    renderSongs(tempSortedSongs);
                }
            });

            orderRandom.addEventListener('change', function() {
                if (isSortModalOpen) {
                    tempSortState.order = 'random';
                    tempSortedSongs = sortSongsPreview(tempSortState.type, tempSortState.order);
                    renderSongs(tempSortedSongs);
                }
            });

            sortByTitle.addEventListener('change', function() {
                if (isSortModalOpen) {
                    tempSortState.type = 'title';
                    tempSortedSongs = sortSongsPreview(tempSortState.type, tempSortState.order);
                    renderSongs(tempSortedSongs);
                }
            });

            sortByArtist.addEventListener('change', function() {
                if (isSortModalOpen) {
                    tempSortState.type = 'artist';
                    tempSortedSongs = sortSongsPreview(tempSortState.type, tempSortState.order);
                    renderSongs(tempSortedSongs);
                }
            });

            cancelBtn.addEventListener('click', function() {
                isSortModalOpen = false;
                sortModal.style.display = 'none';
                sortSongs(previousState.type, previousState.order);
            });

            confirmBtn.addEventListener('click', function() {
                isSortModalOpen = false;
                sortModal.style.display = 'none';
                previousState = { ...tempSortState };
                currentSongs = [...tempSortedSongs];
            });

            document.addEventListener('click', function() {
                if (isSortModalOpen) {
                    isSortModalOpen = false;
                    sortModal.style.display = 'none';
                    sortSongs(previousState.type, previousState.order);
                }
            });

            sortModal.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        function sortSongsPreview(type, order) {
            let sortedSongs = [...currentSongs];
            if (order === 'random') {
                sortedSongs = sortedSongs.sort(() => Math.random() - 0.5);
            } else {
                sortedSongs.sort((a, b) => {
                    const valueA = type === 'title' ? a.title : a.artist;
                    const valueB = type === 'title' ? b.title : b.artist;
                    if (valueA < valueB) return order === 'asc' ? -1 : 1;
                    if (valueA > valueB) return order === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            return sortedSongs;
        }

        function sortSongs(type, order) {
            let sortedSongs = [...currentSongs];
            if (order === 'random') {
                sortedSongs = sortedSongs.sort(() => Math.random() - 0.5);
            } else {
                sortedSongs.sort((a, b) => {
                    const valueA = type === 'title' ? a.title : a.artist;
                    const valueB = type === 'title' ? b.title : b.artist;
                    if (valueA < valueB) return order === 'asc' ? -1 : 1;
                    if (valueA > valueB) return order === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            renderSongs(sortedSongs);
        }

        function initSetting() {
            languageSelect.addEventListener('change', function() {
                updateLanguage(this.value);
            });

            bgFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        bgContainer.style.backgroundImage = `url(${event.target.result})`;
                        currentBgType = 'image';
                        bgUrlInput.value = '';
                        bgRotator.stop(); // 停止自动轮换
                    };
                    reader.readAsDataURL(file);
                }
            });

            bgUrlConfirmBtn.addEventListener('click', function() {
                const url = bgUrlInput.value.trim();
                if (url) {
                    bgContainer.style.backgroundImage = `url(${url})`;
                    currentBgType = 'image';
                    bgFileInput.value = '';
                    bgRotator.stop(); // 停止自动轮换
                }
            });

            bgOpacity.addEventListener('input', function() {
                const opacity = parseFloat(this.value);
                bgContainer.style.opacity = opacity;
                opacityValue.textContent = `${Math.round(opacity * 100)}%`;
            });
        }

        function initSettingSidebar() {
            document.querySelectorAll('.setting-sidebar-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.setting-sidebar-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const target = this.dataset.target;
                    document.querySelectorAll('.setting-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(target).classList.add('active');
                });
            });
        }

        function initColorSelector() {
            document.querySelectorAll('.color-block').forEach(block => {
                block.addEventListener('click', function() {
                    document.querySelectorAll('.color-block').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const color = this.dataset.color;
                    bgContainer.style.backgroundImage = 'none';
                    document.body.style.backgroundColor = color;
                    currentColor = color;
                    currentBgType = 'color';
                    bgFileInput.value = '';
                    bgUrlInput.value = '';
                    bgRotator.stop(); // 停止自动轮换
                });
            });

            document.querySelector(`.color-block[data-color="${currentColor}"]`).classList.add('active');
        }

        function updateLanguage(lang) {
            document.getElementById('title').textContent = langPkg[lang].title;
            document.getElementById('homeText').textContent = langPkg[lang].homeText;
            document.getElementById('collectText').textContent = langPkg[lang].collectText;
            document.getElementById('settingText').textContent = langPkg[lang].settingText;
            document.querySelector('.tag-btn[data-artist="all"]').textContent = langPkg[lang].allTag;
            document.getElementById('searchInput').placeholder = langPkg[lang].searchPlaceholder;
            document.getElementById('listTitle').innerHTML = `${langPkg[lang].listTitle} <span id="countText" class="song-count">(${currentSongs.length}首)</span>`;
            document.getElementById('layoutText').textContent = langPkg[lang].layoutText;
            document.getElementById('sortText').textContent = langPkg[lang].sortText;
            document.getElementById('layoutModalTitle').textContent = langPkg[lang].layoutModalTitle;
            document.getElementById('layoutSingle').nextElementSibling.textContent = langPkg[lang].singleLabel;
            document.getElementById('layoutDouble').nextElementSibling.textContent = langPkg[lang].doubleLabel;
            document.getElementById('layoutTriple').nextElementSibling.textContent = langPkg[lang].tripleLabel;
            document.getElementById('sortModalTitle').textContent = langPkg[lang].sortModalTitle;
            document.getElementById('orderAsc').nextElementSibling.textContent = langPkg[lang].ascLabel;
            document.getElementById('orderDesc').nextElementSibling.textContent = langPkg[lang].descLabel;
            document.getElementById('orderRandom').nextElementSibling.textContent = langPkg[lang].randomLabel;
            document.getElementById('sortByTitle').nextElementSibling.textContent = langPkg[lang].sortTitleLabel;
            document.getElementById('sortByArtist').nextElementSibling.textContent = langPkg[lang].sortArtistLabel;
            document.querySelectorAll('.btn-cancel').forEach(btn => btn.textContent = langPkg[lang].cancelBtn);
            document.querySelectorAll('.btn-confirm').forEach(btn => btn.textContent = langPkg[lang].confirmBtn);
            document.getElementById('collectTitle').textContent = langPkg[lang].collectTitle;
            document.getElementById('collectEmpty').textContent = langPkg[lang].collectEmpty;
            document.getElementById('langTitle').textContent = langPkg[lang].langTitle;
            document.querySelector('label[for="languageSelect"]').textContent = langPkg[lang].langLabel;
            document.getElementById('bgTitle').textContent = langPkg[lang].bgTitle;
            document.querySelector('label[for="bgFileInput"]').textContent = langPkg[lang].bgImgLabel;
            document.getElementById('bgUrlLabel').textContent = langPkg[lang].bgUrlLabel;
            document.querySelector('label[for="bgOpacity"]').textContent = langPkg[lang].opacityLabel;
            document.getElementById('bgColorLabel').textContent = langPkg[lang].bgColorLabel;

            renderSongs(currentSongs);
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', function() {
            initPage();
            initSettingSidebar();
            initColorSelector();
        });
    </script>
</body>
</html>

